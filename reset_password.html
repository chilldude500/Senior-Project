<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Reset Password</title>

    <style>

        body {

            margin: 0;

            padding: 0;

            background-color: skyblue;

            font-family: Arial, sans-serif;

            display: flex;

            justify-content: center;

            align-items: center;

            min-height: 100vh;

        }

        

        .container {

            background-color: white;

            padding: 40px;

            border-radius: 10px;

            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);

            width: 100%;

            max-width: 400px;

        }

        

        h2 {

            margin-top: 0;

            color: #333;

            text-align: center;

        }

        

        .description {

            color: #666;

            font-size: 14px;

            margin-bottom: 20px;

            text-align: center;

        }

        

        .form-group {

            margin-bottom: 20px;

        }

        

        label {

            display: block;

            margin-bottom: 5px;

            color: #555;

            font-weight: bold;

        }

        

        input {

            width: 100%;

            padding: 12px;

            border: 1px solid #ddd;

            border-radius: 5px;

            box-sizing: border-box;

            font-size: 14px;

        }

        

        input:focus {

            outline: none;

            border-color: #4CAF50;

        }

        

        button {

            width: 100%;

            padding: 12px;

            background-color: #4CAF50;

            color: white;

            border: none;

            border-radius: 5px;

            font-size: 16px;

            cursor: pointer;

            transition: background-color 0.3s;

        }

        

        button:hover {

            background-color: #45a049;

        }

        

        button:disabled {

            background-color: #cccccc;

            cursor: not-allowed;

        }

        

        .message {

            margin-top: 15px;

            padding: 12px;

            border-radius: 5px;

            text-align: center;

            display: none;

            font-size: 14px;

        }

        

        .message.success {

            background-color: #d4edda;

            color: #155724;

            border: 1px solid #c3e6cb;

        }

        

        .message.error {

            background-color: #f8d7da;

            color: #721c24;

            border: 1px solid #f5c6cb;

        }

        

        .message.info {

            background-color: #d1ecf1;

            color: #0c5460;

            border: 1px solid #bee5eb;

        }

        

        .password-requirements {

            font-size: 12px;

            color: #666;

            margin-top: 5px;

        }

        

        .back-link {

            text-align: center;

            margin-top: 15px;

        }

        

        .back-link a {

            color: #333;

            text-decoration: none;

            font-size: 14px;

        }

        

        .back-link a:hover {

            text-decoration: underline;

        }

        

        .loading {

            text-align: center;

            padding: 20px;

        }

        

        #resetForm {

            display: none;

        }

    </style>

</head>

<body>

    <div class="container">

        <h2>Reset Your Password</h2>

        

        <div id="loading" class="loading">

            <p>Verifying reset link...</p>

        </div>

        

        <form id="resetForm">

            <p class="description">

                Enter your new password below.

            </p>

            

            <div class="form-group">

                <label for="password">New Password:</label>

                <input type="password" id="password" name="password" required minlength="6">

                <div class="password-requirements">

                    Minimum 6 characters

                </div>

            </div>

            

            <div class="form-group">

                <label for="confirmPassword">Confirm Password:</label>

                <input type="password" id="confirmPassword" name="confirmPassword" required minlength="6">

            </div>

            

            <button type="submit" id="submitBtn">Reset Password</button>

        </form>

        

        <div id="message" class="message"></div>

        

        <div class="back-link">

            <a href="login.html">Back to Login</a>

        </div>

    </div>



    <script>

        let resetToken = '';

        

        // Get token from URL

        const urlParams = new URLSearchParams(window.location.search);

        resetToken = urlParams.get('token');

        

        // Verify token on page load

        window.addEventListener('DOMContentLoaded', async function() {

            const loadingDiv = document.getElementById('loading');

            const resetForm = document.getElementById('resetForm');

            const messageDiv = document.getElementById('message');

            

            if (!resetToken) {

                loadingDiv.style.display = 'none';

                messageDiv.textContent = 'Invalid reset link. Please request a new password reset.';

                messageDiv.className = 'message error';

                messageDiv.style.display = 'block';

                return;

            }

            

            try {

                const response = await fetch(`/api/reset_password/verify?token=${resetToken}`);

                const data = await response.json();

                

                if (response.ok && data.valid) {

                    loadingDiv.style.display = 'none';

                    resetForm.style.display = 'block';

                } else {

                    loadingDiv.style.display = 'none';

                    messageDiv.textContent = data.error || 'Invalid or expired reset link. Please request a new password reset.';

                    messageDiv.className = 'message error';

                    messageDiv.style.display = 'block';

                }

            } catch (error) {

                loadingDiv.style.display = 'none';

                messageDiv.textContent = 'Error verifying reset link. Please try again.';

                messageDiv.className = 'message error';

                messageDiv.style.display = 'block';

            }

        });

        

        // Handle form submission

        document.getElementById('resetForm').addEventListener('submit', async function(e) {

            e.preventDefault();

            

            const submitBtn = document.getElementById('submitBtn');

            const messageDiv = document.getElementById('message');

            const password = document.getElementById('password').value;

            const confirmPassword = document.getElementById('confirmPassword').value;

            

            // Validate passwords match

            if (password !== confirmPassword) {

                messageDiv.textContent = 'Passwords do not match. Please try again.';

                messageDiv.className = 'message error';

                messageDiv.style.display = 'block';

                return;

            }

            

            // Validate password length

            if (password.length < 6) {

                messageDiv.textContent = 'Password must be at least 6 characters long.';

                messageDiv.className = 'message error';

                messageDiv.style.display = 'block';

                return;

            }

            

            // Disable button during submission

            submitBtn.disabled = true;

            submitBtn.textContent = 'Resetting...';

            messageDiv.style.display = 'none';

            

            try {

                const response = await fetch('/api/reset_password/confirm', {

                    method: 'POST',

                    headers: {

                        'Content-Type': 'application/json',

                    },

                    body: JSON.stringify({ 

                        token: resetToken,

                        newPassword: password 

                    })

                });

                

                const data = await response.json();

                

                if (response.ok) {

                    messageDiv.textContent = 'Password reset successful! Redirecting to login...';

                    messageDiv.className = 'message success';

                    messageDiv.style.display = 'block';

                    

                    // Hide form

                    document.getElementById('resetForm').style.display = 'none';

                    

                    // Redirect to login after 2 seconds

                    setTimeout(() => {

                        window.location.href = 'login.html';

                    }, 2000);

                } else {

                    messageDiv.textContent = data.error || 'Failed to reset password. Please try again.';

                    messageDiv.className = 'message error';

                    messageDiv.style.display = 'block';

                    submitBtn.disabled = false;

                    submitBtn.textContent = 'Reset Password';

                }

            } catch (error) {

                messageDiv.textContent = 'Error connecting to server. Please try again later.';

                messageDiv.className = 'message error';

                messageDiv.style.display = 'block';

                submitBtn.disabled = false;

                submitBtn.textContent = 'Reset Password';

            }
        });
    </script>
</body>
</html>